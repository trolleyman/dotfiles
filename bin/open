#!/bin/bash

if [[ $# -ne 1 ]]; then
    echo "Usage: open <file>" >/dev/stderr
fi
file="$1"

set -e

if grep -qE "(Microsoft|WSL)" /proc/version &> /dev/null ; then
    # On WSL
    # Convert to win paths
    cfile=$(wslpath -w "$file") # TODO: Fix wslpath for some paths: https://github.com/microsoft/WSL/issues/4295
    if [[ -d "$file" ]]; then
        # Directory -- use explorer.exe
        ( set +x; explorer.exe "$cfile"; )
    elif [[ -f "$file" ]]; then
        # File -- use cmd.exe to open the file
        ( set +x; cmd /C "$cfile"; )
    else
        echo "error: file does not exist" >/dev/stderr
    fi
elif command -v xdg-open 2>&1 >/dev/null; then
    # Use xdg-open
    echo + xdg-open "$file"
    xdg-open "$file"
else
    echo "error: not yet implemented" >/dev/stderr
    exit 1
fi
